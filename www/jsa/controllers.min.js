angular.module("starter.controllers").controller("AdminCtrl",function(t,n,o,e,a){t.user={},a.show({content:"加载中"});var i="?cmd=customDetail&token="+n.getToken();n.httpGetData(i).success(function(n){t.user=n.data,a.hide()}).error(function(t){a.hide(),o.showAlert("获取信息失败","获取用户信息失败！请重新获取！"),e.go("main")}),t.logout=function(){o.showConfirm("取消登录","确认登出吗?","确定","取消",function(){n.logout().success(function(t){e.go("login")})})},t.toMainPage=function(){e.go("main")},t.goManage=function(){e.go("manage")},t.goClientList=function(){e.go("clientList")}}),angular.module("starter.controllers").controller("ChoseClientCtrl",function(t,n,o,e,a,i,l,r){function c(){var n="";return t.data.clients.forEach(function(t){t.chose&&(n+=t.id+",")}),n.substring(0,n.length-1)}t.data={clients:null,showContent:!1},console.log("Content ID : "+o.contentid),t.contentid=o.contentid,i.show({content:"设备列表加载中"}),l.getClients(function(o){null!==o&&o.length>0?(t.data.showContent=!0,t.data.clients=o):r.showConfirm("设备列表","没有匹配设备,是否去匹配?","确定","取消",function(){n.go("match")},function(){n.go("main")}),i.hide()}),t.goMain=function(){n.go("main")},t.goManage=function(){n.go("manage")},t.menu=function(o){var i=c();if(i.length>0){e.show({buttons:[{text:"立即发布"}],cancelText:"关闭菜单",buttonClicked:function(o){switch(o){case 0:a.publishContents(t.contentid,i).success(function(){r.alertTimeout("发布成功！",2e3,function(){n.go("manage")})}).error(function(t){r.showAlert("发布失败")})}return!0}})}else r.showAlert("内容发布","请选择设备")},t.chose=function(n){t.data.clients.forEach(function(t){if(t.id==n)return t.chose=!t.chose,void console.log("clientID = "+n)})},t.sendVideo=function(){var o=c();o.length>0?(r.showLoading("节目发布中，请稍候..."),a.publishContents(t.contentid,o).success(function(){r.hideLoading(),r.alertTimeout("发布成功！",2e3,function(){n.go("manage")})}).error(function(t){r.hideLoading(),r.showAlert("发布失败")})):r.showAlert("内容发布","请选择设备")}}),angular.module("starter.controllers").controller("ClientCtrl",function(t,n,o,e,a,i,l){function r(n,o){t.data.clients.forEach(function(t){t.id==n&&(t.name=o)})}function c(n){var o;return t.data.clients.forEach(function(t){t.id==n&&(o=t.name)}),console.log(o),o}t.data={clients:null,showContent:!1};var s=function(){i.showConfirm("设备列表","没有匹配设备,是否去匹配?","确定","取消",function(){n.go("match")},function(){n.go("main")})},u=function(){e.show({template:"设备列表加载中"}),a.getClients(function(n){null!==n&&n.length>0?(t.data.showContent=!0,t.data.clients=n,t.$broadcast("scroll.refreshComplete")):s(),e.hide()})};u(),t.goMain=function(){n.go("main")},t.menu=function(n){t.data.name=c(n);o.show({buttons:[{text:"<i class='qukdel'>修改设备名称</i>"}],cancelText:"关闭菜单",cssClass:"bton_style",buttonClicked:function(o){switch(o){case 0:t.changeName(n);break;case 1:}return!0},cancel:function(){console.log("Close Menu"),resetChose()}})},t.changeName=function(n){t.data.name=c(n),l.show({cssClass:"iptTop",template:'<input type="text" maxlength="12" ng-model="data.name" auto-focus>',title:"请输入新设备名",scope:t,buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-positive",onTap:function(n){return t.data.name?t.data.name:void n.preventDefault()}}]}).then(function(t){console.log("id = "+n+" name = "+t),t?a.rename(n,t).success(function(){r(n,t),i.alertTimeout("修改成功！",2e3)}).error(function(t){i.alertTimeout("修改失败",2e3)}):console.log("放弃修改/名字未修改")})},t.unbind=function(n){t.data.name=c(n);var o=function(o){o?a.unbind(n).success(function(){t.removeClient(n),i.alertTimeout("解绑成功！",2e3,function(){0==t.data.clients.length&&s()})}).error(function(t){i.alertTimeout("解绑失败",2e3)}):console.log("放弃解除绑定设备")};i.showConfirm("解除设备","确定解除设备 "+t.data.name+"吗?","确定","取消",o,null,t)},t.doRefresh=function(){u()},t.removeClient=function(n){var o=t.data.clients.findIndex(function(t){return t.id==n});t.data.clients.splice(o,1)}}),angular.module("starter.controllers").controller("LoginCtrl",function(t,n,o,e,a,i){t.data={countdown:60,showMessage:!1,showCountNumber:!1,vaildButton:!1};var l=function(){t.data.countdown=60,t.data.showCountNumber=!1};l(),t.loginSendSMSCode=function(){if(!o.checkMobile(t.data.mobile))return void o.showAlert("提示","不是完整的11位手机号或者正确的手机号前七位！");var e="?cmd=loginOrRegSendSMSCode&mobile="+t.data.mobile;c(),t.data.showMessage=!0,t.data.showCountNumber=!0,n.httpGetData(e).success(function(n){t.data.vaildButton=!0,t.data.message="验证码已发送"}).error(function(n){o.showAlert("获取失败","获取验证码失败！请重新获取！"),t.data.message=n.msgc})},t.loginWithSMSCode=function(){if(!o.checkMobile(t.data.mobile))return void o.showAlert("提示","请输入正确的手机号码！");if(!o.checkSMSCode(t.data.code))return void o.showAlert("提示","短信验证码格式不正确!");var e="?cmd=loginOrRegWithSMSCode&mobile="+t.data.mobile+"&code="+t.data.code;n.httpGetData(e).success(function(t){console.log("login Data = "+JSON.stringify(t)),n.setToken(t.data.token),a.go("main")}).error(function(e){n.setToken(void 0),o.showAlert("登录","登录失败！"),t.data.showMessage=!0,t.data.message=e.msgc})};var r,c=function(){r=i(function(){t.data.countdown--,0===t.data.countdown&&(l(),i.cancel(r))},1e3)};t.clearPhone=function(){t.data.mobile=""}}),angular.module("starter.controllers").controller("MainCtrl",function(t,n,o,e,a,i){t.clickPost=function(){a.go("makeVideo")},t.goManage=function(){a.go("manage")},t.goDevice=function(){a.go("clientList")},t.goAdmin=function(){a.go("admin")},t.goTest=function(){i.show({template:"内容加载中"})}}),angular.module("starter.controllers").controller("makeVideoCtrl",function(t,n,o,e,a,i,l,r,c){t.$on("$ionicView.beforeEnter",function(){t.programData={items:[]},o.hasReadExternalStoragePermissions(function(n){1==n?(t.programData={items:[]},o.selectImage(function(t){t?(s(t),console.log(JSON.stringify(t))):r.goBack()})):r.goBack()})});var s=function(n){t.programData={},t.programData.totaltime=10;for(var o=[],e=0;e<n.length;e++){var a=n[e];a.playtime=t.programData.totaltime/n.length,a.playtime=Math.round(a.playtime),2==e||5==e?a.line=!1:a.line=!0,o.push(a)}t.programData.items=o,t.currentIndex=void 0,t.$apply()};t.clickItem=function(n,o){t.currentIndex=n;for(var e=0;e<t.programData.items.length;e++)n==e?t.programData.items[e].selected=!0:t.programData.items[e].selected=!1},t.clickPlayTurn=function(){o.showPopup("请输入轮播的总时长(秒)","",function(t){!t||t<0||m(t)},t,"number")},t.clickCustom=function(){return void 0==t.currentIndex?void o.alertTimeout("请选择图片进行设置！",2e3):void o.showPopup("请输入播放时间(秒)","",function(t){!t||t<0||f(t)},t,"number")},t.startMaking=function(){o.showPopup("请输入节目名称","",function(t){t&&t.length>0&&g(t)},t,"text")},t.toMainPage=function(){i.go("main")};var u=function(n){for(var o=[],e=t.programData.items,a=0;a<e.length;a++)""==n[a].id&&o.push(e[a]);return o},d=function(t,o){n.createProgram(t,function(t){t?(console.log(JSON.stringify(t)),o&&o(t)):o&&o(void 0)})},g=function(e){o.showLoading("节目制作中，请稍候..."),t.programData.name=e,n.existFileMD5s(t.programData.items,function(e){if(e){var a=u(e.data),l=0,r=a.length;if(0==r)return void d(t.programData,function(t){t?o.showAlert("","制作节目成功！",function(){i.go("manage")}):o.showAlert("","制作节目失败！"),o.hideLoading()});for(var c=0;c<r;c++)n.postImage(a[c],function(n){n?(l++,l==r&&d(t.programData,function(t){t?o.showAlert("","制作节目成功！",function(){i.go("manage")}):o.showAlert("","制作节目失败！"),o.hideLoading()})):(o.hideLoading(),console.log("上传图片失败"))})}else o.hideLoading(),o.showAlert("上传图失败！")})},f=function(n){if(void 0!=t.currentIndex){var o=t.programData.items[t.currentIndex],e=o.playtime;o.playtime=n,t.programData.totaltime+=o.playtime-e}},m=function(n){t.programData.totaltime=n;for(var o=0;o<t.programData.items.length;o++){var e=t.programData.items[o];e.playtime=t.programData.totaltime/t.programData.items.length,e.playtime=Math.round(e.playtime)}}}),angular.module("starter.controllers").controller("ManageCtrl",function(t,n,o,e,a,i,l,r,c){t.data={galleryTop:null,galleryThumbs:null,photos:null,deleteAll:"0",showContent:0},t.toMainPage=function(){n.go("main")},null===t.data.photos&&(a.show({template:"内容加载中"}),i.getOnlineContents(function(n){a.hide(),null!==n?n.length>0?(t.data.showContent=1,t.data.photos=n,console.log("节目长度:"+t.data.photos.length)):(t.data.showContent=2,t.noContentConfirm()):l.showAlert("内容获取失败")})),t.menu=function(){e.show({buttons:[{text:"<div class='qukdel topquck'>预览节目</div>"},{text:"<div class='conquck'>立即发布</div>"},{text:"<div class='qukdel btmquck'>删除节目</div>"}],cancelText:"关闭菜单",cssClass:"bton_style",buttonClicked:function(n){switch(n){case 0:t.preViewUrl();break;case 1:t.publishContent();break;case 2:t.removeContent()}return!0}})},t.$on("ngRepeatFinished",function(){t.data.galleryTop=new Swiper(".swiper-container",{nextButton:".swiper-button-next",prevButton:".swiper-button-prev",slidesPerView:2,centeredSlides:!0,spaceBetween:80})}),t.noContentConfirm=function(){l.showConfirm("内容管理","没有节目内容,是否去创建?","确定","取消",function(){n.go("makeVideo",{getPremission:!0})},function(){n.go("main")})},t.preViewUrl=function(){var n=t.data.galleryTop.activeIndex,o=t.data.photos[n].preview_url,e={location:"no"};r.open(o,"_blank",e).then(function(){console.log("InAppBrowser opened "+o+" successfully")},function(t){console.log("Error: "+t)})},t.publishContent=function(o){var e=t.data.galleryTop.activeIndex,o=t.data.photos[e].id;n.go("choseClient",{contentid:o})},t.removeContent=function(){var n=t.data.galleryTop.activeIndex,o=t.data.photos[n].id,e=function(e){i.removeContents(o,t.data.deleteAll).success(function(){l.alertTimeout("删除成功",2e3,function(){t.data.photos.splice(n,1),t.data.galleryTop.removeSlide(n),t.data.deleteAll="0",0===t.data.photos.length&&(t.data.showContent=2,t.noContentConfirm())})}).error(function(t){l.alertTimeout("删除失败",2e3)})};l.showConfirm("删除节目",'<p class="fxcen"><input class="delput" type="checkbox" ng-model="data.deleteAll" ng-true-value="1" ng-false-value="0"/><span class="textcen">是否同时删除设备上的该节目?</span></p>',"确定","取消",e,null,t)},t.showClientList=function(){var n=t.data.galleryTop.activeIndex,o=t.data.photos[n].client,e="";if(o.length>0){var o=o.split(",");e='<ul class="jmtit">',o.forEach(function(t){e+='<li class="jmtitli">'+t+"</li>"}),e+="</ul>"}else e="未发布";c.show({template:e,title:"发布设备列表",scope:t,cssClass:"sList",buttons:[{text:""}]})}}),angular.module("starter.controllers").controller("MatchCtrl",function(t,n,o,e,a,i){function l(){t.data={focusInput:!1,message:"",showNextButton:!1,showGif:!1}}l(),t.clientBind=function(){o.showLoading("设备匹配中，请稍候..."),t.data.showGif=!0;var e="?cmd=clientBind&token="+n.getToken()+"&id="+t.data.clientID+"&name="+t.data.clientID;n.httpGetData(e).success(function(n){console.log("Data = "+JSON.stringify(n)),i(function(){t.data.showGif=!1,o.hideLoading(),0===n.result?(t.data.showNextButton=!0,t.data.message="配对成功",o.alertTimeout("配对成功",2e3,function(){t.goList()})):t.data.message=n.msgc},2e3)}).error(function(n){i(function(){t.data.showGif=!1,t.data.message="配对失败",o.hideLoading()},2e3)})},t.goList=function(){l(),a.go("clientList")},t.goMain=function(){l(),a.go("main")},t.goClientList=function(){l(),a.go("clientList")}}),angular.module("starter.controllers").controller("testCtrl",function(){var t=new Swiper(".gallery-top",{nextButton:".swiper-button-next",prevButton:".swiper-button-prev",spaceBetween:10,loop:!0,loopedSlides:5}),n=new Swiper(".gallery-thumbs",{spaceBetween:10,slidesPerView:5,touchRatio:.2,loop:!0,loopedSlides:5,slideToClickedSlide:!0});t.params.control=n,n.params.control=t});